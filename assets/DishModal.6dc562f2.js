var J=Object.defineProperty,X=Object.defineProperties;var Y=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var T=(e,n,o)=>n in e?J(e,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[n]=o,R=(e,n)=>{for(var o in n||(n={}))q.call(n,o)&&T(e,o,n[o]);if(I)for(var o of I(n))G.call(n,o)&&T(e,o,n[o]);return e},P=(e,n)=>X(e,Y(n));var V=(e,n,o)=>new Promise((F,k)=>{var w=l=>{try{p(o.next(l))}catch(d){k(d)}},c=l=>{try{p(o.throw(l))}catch(d){k(d)}},p=l=>l.done?F(l.value):Promise.resolve(l.value).then(w,c);p((o=o.apply(e,n)).next())});import{B as K,u as Q,b as W}from"./index.2268f048.js";import{modalFormSchema as j,contentSchema as Z}from"./data.136e6fd6.js";import{a3 as x,a as ee,v as B,k as O,f as te,V as oe,X as f,o as s,h,n as u,z as _,H as y,$ as b,j as A,i as D,l as z,Y as ae,J as ne,B as H}from"./index.051b8e6d.js";import le from"./MaterialModal.9fc3a03b.js";import{D as re}from"./DeleteOutlined.37a665c8.js";import"./useWindowSizeFn.dbf4cc23.js";import"./FullscreenOutlined.6ce9a280.js";import"./TableImg.6806e059.js";import"./index.f9c0747d.js";import"./eagerComputed.2b892fda.js";import"./BasicForm.99673a00.js";import"./index.3ec80e2e.js";import"./index.9cd125ba.js";import"./index.91f19117.js";import"./index.d091d485.js";import"./index.0a3ccb18.js";import"./transButton.64b42905.js";import"./index.1226963b.js";import"./index.869b6f14.js";import"./index.29220c51.js";import"./useRefs.30331c8d.js";import"./index.3ee0c50a.js";import"./index.66663891.js";import"./uuid.2b29000c.js";import"./download.a6ed5dfa.js";import"./base64Conver.08b9f4ec.js";import"./index.f028e9a2.js";import"./index.3ddd1a12.js";import"./uniqBy.6301f91d.js";import"./useForm.140b2a6b.js";import"./index.2b14c180.js";import"./index.c4040988.js";import"./index.900b54f5.js";import"./useContentViewHeight.acab2293.js";import"./ArrowLeftOutlined.339bcb08.js";import"./index.47f7791d.js";import"./sortable.esm.2632adaa.js";import"./RedoOutlined.3327e8b0.js";import"./fromPairs.84aabb58.js";import"./scrollTo.c66d7144.js";import"./index.3ee59996.js";import"./index.7873e13f.js";import"./useTable.563ac532.js";import"./table.59f67c33.js";const ie=x(le),se=ee({name:"DishesModal",components:{BasicModal:K,DeleteOutlined:re,MaterialModal:ie},emits:["success","register"],setup(e,{emit:n}){const o=B([]),{createMessage:F}=ne(),[k,{openModal:w}]=Q(),c=B(!0),p=B(""),l=B([]),[d,{setModalProps:M,closeModal:E}]=W(t=>V(this,null,function*(){if(M({confirmLoading:!1}),c.value=!!(t!=null&&t.isUpdate),O(c)){p.value=t.record.id;const a=R({},t.record);a.content||(a.content=[]),l.value=[a]}})),S=te(()=>O(c)?"\u7F16\u8F91\u83DC\u54C1":"\u65B0\u589E\u83DC\u54C1");function U(){return V(this,null,function*(){try{for(const i of o.value)yield i.validate();const t=l.value;let a=!0;t.forEach(i=>{i.name||(a=!1),!i.content||!i.content.length?a=!1:i.content.forEach(N=>{N.material||(a=!1),N.weight||(a=!1)})}),a?(M({confirmLoading:!0}),E(),n("success",{isUpdate:O(c),values:P(R({},t),{id:p.value})})):F.warn("\u8868\u5355\u9A8C\u8BC1\u4E0D\u901A\u8FC7\uFF0C\u8BF7\u68C0\u67E5")}catch(t){M({confirmLoading:!1})}})}function $(t=[]){const a={};return t.forEach(i=>{a[i.field]=i.defaultValue||""}),a}function v(){const t=$(j);t.content=[],l.value.push(t)}const C=B(0);function r(t,a){l.value[t].content.push(a)}function g(t){C.value=t,w(!0)}function m(t){const a=t.data||[];a.forEach(i=>{r(C.value,{material:i.name,weight:i.weight})})}function L(t,a){a.splice(t,1)}return l.value.length||v(),{registerModal:d,getTitle:S,handleSubmit:U,foodList:l,modalFormSchema:j,contentSchema:Z,isUpdate:c,addFood:v,addMaterial:r,delInput:L,formRef:o,registerMater:k,openMaterModal:g,handleMaterial:m}}}),ue=D("div",{class:"text-right ant-form-item-label",style:{width:"120px"}},[D("label",null,"\u83DC\u54C1\u5185\u5BB9")],-1),ce={class:"text-center"},me=H("+ \u6DFB\u52A0\u539F\u6599"),pe={key:0,class:"text-center"},de=H("\u6DFB\u52A0\u83DC\u54C1");function fe(e,n,o,F,k,w){const c=f("a-input"),p=f("a-form-item"),l=f("DeleteOutlined"),d=f("a-button"),M=f("a-space"),E=f("a-form"),S=f("a-divider"),U=f("BasicModal"),$=f("MaterialModal");return s(),h("div",null,[u(U,ae(e.$attrs,{onRegister:e.registerModal,title:e.getTitle,width:800,onOk:e.handleSubmit}),{default:_(()=>[(s(!0),h(y,null,b(e.foodList,(v,C)=>(s(),h("div",{key:C},[u(E,{ref_for:!0,ref:"formRef",model:v,name:"basic","label-col":{style:{width:"120px"}},"wrapper-col":{span:18},autocomplete:"off"},{default:_(()=>[(s(!0),h(y,null,b(e.modalFormSchema,(r,g)=>(s(),A(p,{key:g,label:r.label,name:r.field,rules:r.rules},{default:_(()=>[u(c,{value:v[r.field],"onUpdate:value":m=>v[r.field]=m},null,8,["value","onUpdate:value"])]),_:2},1032,["label","name","rules"]))),128)),u(M,{align:"start"},{default:_(()=>[ue,D("div",null,[(s(!0),h(y,null,b(v.content,(r,g)=>(s(),h("div",{key:g},[u(M,{align:"start"},{default:_(()=>[(s(!0),h(y,null,b(e.contentSchema,(m,L)=>(s(),A(p,{key:L,label:m.label,name:["content",C,m.field],"label-col":{style:{width:"80px"}},rules:m.rules},{default:_(()=>[u(c,{value:r[m.field],"onUpdate:value":t=>r[m.field]=t,disabled:""},null,8,["value","onUpdate:value"])]),_:2},1032,["label","name","rules"]))),128)),g>0?(s(),A(d,{key:0,onClick:m=>e.delInput(g,v.content)},{default:_(()=>[u(l)]),_:2},1032,["onClick"])):z("",!0)]),_:2},1024)]))),128))])]),_:2},1024)]),_:2},1032,["model"]),D("div",ce,[u(d,{onClick:r=>e.openMaterModal(C)},{default:_(()=>[me]),_:2},1032,["onClick"])]),u(S)]))),128)),e.isUpdate?z("",!0):(s(),h("div",pe,[u(d,{type:"primary",onClick:e.addFood},{default:_(()=>[de]),_:1},8,["onClick"])]))]),_:1},16,["onRegister","title","onOk"]),u($,{onRegister:e.registerMater,onSuccess:e.handleMaterial},null,8,["onRegister","onSuccess"])])}var rt=oe(se,[["render",fe]]);export{rt as default};
